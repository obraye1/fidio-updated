function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o,n=arguments[t];for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}import React from"react";import Head from"next/head";import io from"socket.io-client";import{SocketContainer}from"/modules/socket";import{resolveVariables}from"/app.config";import{checkSignedIn,checkUserData,updateLocalLoginSession}from"/modules/utility/onboarding/SignIn";import{_LocalEventEmitter}from"/modules/events/LocalEventEmitter";import{handleRouteChange,registerCheckLocalStorageSize,registerCheckMobile,registerProxyConsoleLog}from"/modules/util";import{useRouter}from"next/router";import{forceUpdateProps,handleCheckUserData,handleGlobalEvent,handleSetCart,handleSetLoggedIn,registerSocket,toggleSingleOpenMenu}from"/modules/utility/_app";import{UseMiddleware}from"../../customModules/middleware";import{DeveloperHelp}from".";import{GoogleGsiClient,GoogleSignInRegister}from"/modules/internal/localImports";import{constructGeneral,paintMeta}from"./meta/general";import middlewareFunctions from"/customModules/middleware/MiddlewareFunctions";const CHECK_HANDLE_USER_DATA_THRESHOLD=18e5,Internal=e=>{const[t,o]=React.useState(!1),[n,i]=React.useState(!1);var[a,r]=React.useState(!1);const[l,s]=React.useState(!1);var[c,g]=React.useState(null);const[d,u]=React.useState({}),[m,_]=React.useState({}),[p,f]=React.useState(!1);var[E,h]=React.useState({});const[S,R]=React.useState(!1),[v,b]=React.useState(null);var[I,C]=React.useState(!1),[w,L]=React.useState(!1);const[y,M]=React.useState(-1);let k=Object.assign({},e);const O=useRouter();try{registerCheckLocalStorageSize(window),registerCheckMobile(window),registerProxyConsoleLog(window)}catch(e){}React.useEffect(()=>{var e;t?(e=window.mobileCheck(),R(e)):o(!0)},[t]),React.useEffect(()=>{document.addEventListener("mute-login-error",()=>{s(null)},{once:!0})},[]);const D=async()=>{handleSetLoggedIn(k,checkSignedIn,i);var e=await handleCheckUserData(k,n);k&&n&&y<(new Date).getTime()-CHECK_HANDLE_USER_DATA_THRESHOLD&&e&&(M((new Date).getTime()),(async(e,t)=>{e=await checkUserData(e,t);if(e){t=Object.assign({},n);if(console.log(e,t),e.identifier&&e.username&&e.hash)return t.username=e.username,t.hash=e.hash,t.identifier=e.identifier,t.ip=e.ip,t.meta||(t.meta={}),e.ip&&(t.meta.ip=e.ip),e.location&&(t.meta.location=e.location),e.locationMeta&&(t.meta.locationMeta=e.locationMeta),console.log(t),updateLocalLoginSession(t),!i(t)}})(k,e))};React.useEffect(()=>{D()},[n,k._loggedIn]);React.useEffect(()=>{handleSetCart(n,_)},[n]),k._LocalEventEmitter=_LocalEventEmitter,k._loggedIn=n,k._setLoggedIn=i,k._stripeSecret=a,k._setStripeSecret=r,k._loginError=l,k._setLoginError=s,k._pageError=c,k._setPageError=g,k._toggleSingleOpenMenu=(e,t,o)=>{toggleSingleOpenMenu(e,t,d,u,o)},k._openMenu=d,k._setOpenMenu=u,k._cart=m,k._rooms=E,k._isMobile=S,k._adminAuth=v,k._setAdminAuth=b,k._managerOpen=I,k._setManagerOpen=C,k._currentlyStreaming=w,k._setCurrentlyStreaming=L,k.fetchBusy=p,k.setFetchBusy=f;e=resolveVariables();k._configVariables=e,k=Object.assign(resolveVariables(),k),_LocalEventEmitter.unsubscribe("forceUpdateProps"),_LocalEventEmitter.subscribe("forceUpdateProps",e=>{forceUpdateProps(e,_)}),_LocalEventEmitter.unsubscribe("global_event"),_LocalEventEmitter.subscribe("global_event",async e=>{handleGlobalEvent(e,k,p,f)}),_LocalEventEmitter.unsubscribe("attemptInitializeGoogle"),_LocalEventEmitter.subscribe("attemptInitializeGoogle",async e=>{U()});const G=e=>{e=new CustomEvent("thirdparty-signin",{detail:e});document.dispatchEvent(e)},U=(t=250)=>{try{return(!window||window&&!window.googleInitialized)&&k.googleClientId&&(google.accounts.id.initialize({client_id:k.googleClientId,callback:G,use_fedcm_for_prompt:!0}),window.googleInitialized=!0,console.log("Google Loaded")),!0}catch(e){setTimeout(()=>{U(2*t)},t)}},[A,x]=(React.useEffect(()=>{console.log,k?._loggedIn?.admin&&!v&&k?.dborigin&&k?._loggedIn?.admin.origin&&k.dborigin===k._loggedIn.admin.origin&&k._loggedIn.admin?.userid&&k?._loggedIn?.identifier&&k._loggedIn.admin.userid===k._loggedIn.identifier?b(k._loggedIn.admin):(!v?.userid||!k?._loggedIn||k?._loggedIn&&!k._loggedIn.identifier||v?.userid&&k?._loggedIn?.identifier&&v.userid!==k._loggedIn.identifier||!k?._adminAuth?.origin||!k?.dborigin||k?._adminAuth?.origin&&k.dborigin&&k._adminAuth.origin!==k.dborigin)&&b(null)},[k._loggedIn,v]),React.useState(null)),[H,P]=React.useState(null);React.useEffect(()=>{registerSocket(io,A,x,H,k,P)},[A,H]),React.useEffect(()=>{const e=(e,t)=>{handleRouteChange(k,e,t)};return O.events.on("routeChangeComplete",e),()=>{O.events.off("routeChangeComplete",e)}},[O.events,k._loggedIn,k.apiUrl,k.domainKey]),k._socket=A,console.log("Socket",A,k);a=React.useMemo(()=>{var e=constructGeneral(O,k);return middlewareFunctions?.transformMeta?middlewareFunctions.transformMeta(O,e,k):e},[O?.path,k]);return React.createElement("div",null,React.createElement(Head,null,React.createElement("title",null,k.siteTitle),k?.googleClientId?React.createElement("meta",{name:"google-signin-client_id",content:""+k.googleClientId}):null,paintMeta(a)),k?.googleClientId?React.createElement("div",null,GoogleGsiClient,GoogleSignInRegister(k.googleClientId)):null,React.createElement(SocketContainer,_extends({_socket:A,setRooms:h},k)),React.createElement("div",{className:p?"fetchNotBusy fetchBusy":"fetchNotBusy"}),React.createElement(UseMiddleware,k),k?.dev?React.createElement(DeveloperHelp,k):null)};export default Internal;