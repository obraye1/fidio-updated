function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,a=arguments[t];for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}import React from"react";import SubMenu from"./SubMenu.js";import menuStyle from"./Menu.module.scss";import Link from"next/link";import{checkSignedInAndPrompt,logout}from"/modules/utility/onboarding/SignIn.js";import{addToCart,calculateTotal,performPurchase,updateCart}from"/modules/utility/ecommerce/ecommerce.js";import{CartInternal}from"../ecommerce/cart/";import{Notifications}from"../notifications";import{Help}from"../help/index.js";import Tooltip from"@mui/material/Tooltip";import{SurveyContainer}from"../survey/index.js";import{DropMenu}from"/layout/index.js";const Module=s=>{const[u,g]=React.useState(!1),[,a]=React.useState(null);var[,,]=React.useState(!0);const[t,n]=React.useState(!1);React.useCallback(e=>{a(null)});const l=React.useCallback(e=>{e&&s&&s._toggleSingleOpenMenu&&s._toggleSingleOpenMenu(e,"main_settings")},[s._openMenu]),c=React.useCallback(e=>{logout(),s._toggleSingleOpenMenu(e,"main_settings"),setTimeout(()=>{s._LocalEventEmitter.dispatch("showSignIn",{})},4e3)}),i=React.useCallback(e=>{s._toggleSingleOpenMenu(e,"main_settings"),checkSignedInAndPrompt()}),o=React.useCallback(e=>{e&&s&&s._toggleSingleOpenMenu&&s._toggleSingleOpenMenu(e,"cart")}),r=React.useCallback(e=>{e&&s&&s._toggleSingleOpenMenu&&s._toggleSingleOpenMenu(e,"notifications")});var e=e=>{s.menuConfig.menuOpenAfterCartInteraction&&s._toggleSingleOpenMenu(null,e??"cart",!0)};React.useCallback(async t=>{try{if(console.log(t.currentTarget.getAttribute,u),!u&&t&&t.currentTarget&&t.currentTarget.getAttribute){g(!0);var n=t.currentTarget.getAttribute("styleId"),a=t.currentTarget.getAttribute("optionId"),l=t.currentTarget.getAttribute("quantity");const m=t.currentTarget.getAttribute("productId");var c={};Number(t.currentTarget.value)<Number(l)&&(c.decrement=!0);let e;var i,o,r=JSON.parse(localStorage.getItem("cart"));(e=m&&r&&r.items?r.items.find(e=>e.product.id===m):e)&&(i=await addToCart(s.apiUrl,s.domainKey,s._loggedIn,r,e.product,{style:n,option:a},g,c))&&"success"===i.status&&(updateCart(r,i.cart),i.cart)&&i.cart.items&&(o=i.cart.items.find(e=>e.product.id===m))&&(t.target.value=o.quantity),g(!1)}}catch(e){console.log(e),g(!1)}});const m="undefined"!=typeof window?JSON.parse(localStorage.getItem("cart")):null;React.useCallback(async e=>{try{var t,n;u||(g(!0),a(null),console.log(m),t=calculateTotal(m,null,{object:!0}),console.log("snapshot",t),(n=await performPurchase(s.apiUrl,s.domainKey,s._loggedIn,m,g,{snapshot:t}))?(console.log(n),"success"===n.status&&console.log("Purchase Success",n)):a({message:"Purchase failed",placement:"purchase"}),g(!1))}catch(e){g(!1)}});const d=React.useCallback(e=>{e&&s&&s._toggleSingleOpenMenu&&s._toggleSingleOpenMenu(e,"feedback")}),p=React.useCallback(e=>{e&&s&&s._toggleSingleOpenMenu&&s._toggleSingleOpenMenu(e,"bugReport")}),S=React.useCallback(e=>{t?n(!1):n(!0)}),y=React.useCallback(e=>{s._toggleSingleOpenMenu(null,{},!0),n(!1)}),f=s?.regionsData&&s?._loggedIn?.meta?.locationMeta?.country&&s.regionsData[s._loggedIn.meta.locationMeta.country]&&s.regionsData[s._loggedIn.meta.locationMeta.country].name?s.regionsData[s._loggedIn.meta.locationMeta.country].name:s?._loggedIn?.meta?.locationMeta?.country??null;return React.createElement(React.Fragment,null,s?.useMenu?React.createElement("div",{style:{width:"100%",height:s?.menuConfig?.height?s.menuConfig.height+"px":"",padding:s?.menuConfig?.padding?s.menuConfig.padding:""},className:`leadMenuContainer ${menuStyle.container} darkModeEnforce Menu_LeadContainer `+s.className},React.createElement("div",{style:{paddingBottom:0,paddingTop:0,maxHeight:"100%"},className:"margin1600 menuContainer"},React.createElement(SubMenu,_extends({},s,{handleToggleMenuOff:y})),React.createElement("ul",{className:s._loggedIn?menuStyle.menu:menuStyle.menu+" "+menuStyle.menuClosed},s?.menuConfig?.right?s.menuConfig.right.map((e,t)=>React.createElement(React.Fragment,{key:t},e.type?"user"===e.type?React.createElement(DropMenu,_extends({},s,{resolvedCountry:f,handleToggleSettings:l,handleLogout:c,fireHelp:S,fireShareFeedback:d,fireShareBug:p,fireShowSignIn:i})):"cart"===e.type?React.createElement("div",{className:e.className+" "+(e.smallUntilHover?""+menuStyle.smallUntilHover:null)},React.createElement(Tooltip,{title:"Cart",placement:"bottom"},React.createElement("li",{className:menuStyle.menuLink+" darkMenuLink menuLinkSelector",onClick:o,style:{alignSelf:"center"}},React.createElement("span",{className:""+menuStyle.menuLinkText},React.createElement("div",{className:""+menuStyle.menuText},"Cart"),React.createElement("div",{className:`${menuStyle.menuLinkIconPair} ${menuStyle.maxIconWidth} cart material-icons`},"shopping_cart")),React.createElement("div",{className:`${menuStyle.menuLinkIcon} ${menuStyle.maxIconWidth} cart material-icons`},"shopping_cart")))):"stream"===e.type?React.createElement(Link,{href:e.href,className:`menuLinkSelector ${e.className} `+(e.smallUntilHover?""+menuStyle.smallUntilHover:null),style:{alignSelf:"center"}},React.createElement(Tooltip,{title:"Livestream Now",placement:"bottom"},React.createElement("li",{className:menuStyle.menuLink+" darkMenuLink menuLinkSelector "+e.className,style:{alignSelf:"center"},onClick:y},React.createElement("span",{className:""+menuStyle.menuLinkText},React.createElement("div",{className:""+menuStyle.menuText},"Stream"),React.createElement("div",{className:`${menuStyle.menuLinkIconPair} ${menuStyle.maxIconWidth} live_tv material-icons`},"live_tv")),React.createElement("div",{className:`${menuStyle.menuLinkIcon} ${menuStyle.maxIconWidth} live_tv material-icons`},"live_tv")))):"notifications"===e.type?React.createElement("div",{className:`menuLinkSelector ${e.className} `+(e.smallUntilHover?""+menuStyle.smallUntilHover:null),style:{alignSelf:"center"}},React.createElement(Tooltip,{title:"Notifications",placement:"bottom"},React.createElement("li",{className:menuStyle.menuLink+" darkMenuLink menuLinkSelector "+e.className,style:{alignSelf:"center"},onClick:r},React.createElement("span",{className:""+menuStyle.menuLinkText},React.createElement("div",{className:""+menuStyle.menuText},"Notifications"),React.createElement("div",{className:`${menuStyle.menuLinkIconPair} ${menuStyle.maxIconWidth} live_tv material-icons`},"notifications")),React.createElement("div",{className:`${menuStyle.menuLinkIcon} ${menuStyle.maxIconWidth} live_tv material-icons`},"notifications")))):"link"===e.type?React.createElement(Link,{href:e.href,className:"menuLinkSelector "+e.className,style:{alignSelf:"center"}},React.createElement("li",{className:menuStyle.menuLink+" darkMenuLink menuLinkSelector "+e.className,style:{alignSelf:"center"}},React.createElement("span",{className:""+menuStyle.menuLinkText},React.createElement("div",null,e.name)),React.createElement("div",{className:`${menuStyle.menuLinkIcon} ${menuStyle.maxIconWidth} material-icons`},e.name))):null:null)):null)),React.createElement(Help,_extends({},s,{open:t,setHelpOpen:n})),React.createElement(CartInternal,_extends({},s,{passOveride:e,forceShowCc:s?.paymentConfig?.forceShowCc})),React.createElement(Notifications,_extends({},s,{passOveride:e,forceShowCc:s?.paymentConfig?.forceShowCc})),React.createElement(SurveyContainer,_extends({},s,{handleName:"feedback",survey:s?.feedbackConfig?.surveyData})),React.createElement(SurveyContainer,_extends({},s,{handleName:"bugReport",survey:s?.feedbackConfig?.bugReportData}))):null)};export default Module;